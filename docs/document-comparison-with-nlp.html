<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Document Comparison with NLP | Applied NLP for Document Analysis</title>
  <meta name="description" content="Bookdown report with examples of applied NLP for document analysis" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Document Comparison with NLP | Applied NLP for Document Analysis" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://https://nickptaylor.github.io/nlp-document-analysis/" />
  
  <meta property="og:description" content="Bookdown report with examples of applied NLP for document analysis" />
  <meta name="github-repo" content="nickptaylor/nlp-document-analysis" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Document Comparison with NLP | Applied NLP for Document Analysis" />
  
  <meta name="twitter:description" content="Bookdown report with examples of applied NLP for document analysis" />
  

<meta name="author" content="Nick P Taylor" />


<meta name="date" content="2020-06-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="website-comparison-with-nlp.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied NLP for Document Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="document-comparison-with-nlp.html"><a href="document-comparison-with-nlp.html"><i class="fa fa-check"></i><b>1</b> Document Comparison with NLP</a><ul>
<li class="chapter" data-level="1.1" data-path="document-comparison-with-nlp.html"><a href="document-comparison-with-nlp.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="document-comparison-with-nlp.html"><a href="document-comparison-with-nlp.html#read-document"><i class="fa fa-check"></i><b>1.2</b> Read Document</a></li>
<li class="chapter" data-level="1.3" data-path="document-comparison-with-nlp.html"><a href="document-comparison-with-nlp.html#tidy-corpus"><i class="fa fa-check"></i><b>1.3</b> Tidy Corpus</a></li>
<li class="chapter" data-level="1.4" data-path="document-comparison-with-nlp.html"><a href="document-comparison-with-nlp.html#analsysis"><i class="fa fa-check"></i><b>1.4</b> Analsysis</a></li>
<li class="chapter" data-level="1.5" data-path="document-comparison-with-nlp.html"><a href="document-comparison-with-nlp.html#exploratory-analysis"><i class="fa fa-check"></i><b>1.5</b> Exploratory Analysis</a><ul>
<li class="chapter" data-level="1.5.1" data-path="document-comparison-with-nlp.html"><a href="document-comparison-with-nlp.html#word-frequency"><i class="fa fa-check"></i><b>1.5.1</b> Word Frequency</a></li>
<li class="chapter" data-level="1.5.2" data-path="document-comparison-with-nlp.html"><a href="document-comparison-with-nlp.html#commonality-cloud"><i class="fa fa-check"></i><b>1.5.2</b> Commonality Cloud</a></li>
<li class="chapter" data-level="1.5.3" data-path="document-comparison-with-nlp.html"><a href="document-comparison-with-nlp.html#comparison-cloud"><i class="fa fa-check"></i><b>1.5.3</b> Comparison Cloud</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="website-comparison-with-nlp.html"><a href="website-comparison-with-nlp.html"><i class="fa fa-check"></i><b>2</b> Website Comparison with NLP</a><ul>
<li class="chapter" data-level="2.1" data-path="website-comparison-with-nlp.html"><a href="website-comparison-with-nlp.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="website-comparison-with-nlp.html"><a href="website-comparison-with-nlp.html#web-scraping"><i class="fa fa-check"></i><b>2.2</b> Web Scraping</a></li>
<li class="chapter" data-level="2.3" data-path="website-comparison-with-nlp.html"><a href="website-comparison-with-nlp.html#tokenisation"><i class="fa fa-check"></i><b>2.3</b> Tokenisation</a></li>
<li class="chapter" data-level="2.4" data-path="website-comparison-with-nlp.html"><a href="website-comparison-with-nlp.html#ssec:tfidf"><i class="fa fa-check"></i><b>2.4</b> Term-frequency Inverse Document-Frequency</a></li>
<li class="chapter" data-level="2.5" data-path="website-comparison-with-nlp.html"><a href="website-comparison-with-nlp.html#word-clouds"><i class="fa fa-check"></i><b>2.5</b> Word Clouds</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applied NLP for Document Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="document-comparison-with-nlp" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Document Comparison with NLP</h1>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">1.1</span> Introduction</h2>
<p>Herein, an example of applying NLP to legal proceedings will be demonstrated. Legal documents are notoriously verbose and the objective will be to:</p>
<blockquote>
<p>Summarise, compare and contrast transcriptions of cases heard on the subject of ‘Trust and Probate’ in the High Court of Justice, London.</p>
</blockquote>
<p>The transcriptions are publicly available via the <a href="https://www.iclr.co.uk/">Incorporated Council of Law Reporting</a> in the form of PDF (Portable Document Format) documents.</p>
</div>
<div id="read-document" class="section level2">
<h2><span class="header-section-number">1.2</span> Read Document</h2>
<p>The documents for analysis are described using JSON (JavaScript Object Notation) as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="document-comparison-with-nlp.html#cb1-1"></a><span class="ot">[</span></span>
<span id="cb1-2"><a href="document-comparison-with-nlp.html#cb1-2"></a>    <span class="fu">{</span></span>
<span id="cb1-3"><a href="document-comparison-with-nlp.html#cb1-3"></a>        <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Rittson-Thomas v Oxfordshire County Council&quot;</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="document-comparison-with-nlp.html#cb1-4"></a>        <span class="dt">&quot;url&quot;</span><span class="fu">:</span> <span class="st">&quot;https://www.iclr.co.uk/document/2018000552/transcriptXml_2018000552_2019031210462874/pdf/download&quot;</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="document-comparison-with-nlp.html#cb1-5"></a>        <span class="dt">&quot;use_fonts&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">10</span><span class="ot">,</span> <span class="dv">13</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-6"><a href="document-comparison-with-nlp.html#cb1-6"></a>        <span class="dt">&quot;page_range&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">2</span><span class="ot">,</span> <span class="st">&quot;Inf&quot;</span><span class="ot">]</span></span>
<span id="cb1-7"><a href="document-comparison-with-nlp.html#cb1-7"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb1-8"><a href="document-comparison-with-nlp.html#cb1-8"></a>    <span class="fu">{</span></span>
<span id="cb1-9"><a href="document-comparison-with-nlp.html#cb1-9"></a>        <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Kingsley v Kingsley&quot;</span><span class="fu">,</span></span>
<span id="cb1-10"><a href="document-comparison-with-nlp.html#cb1-10"></a>        <span class="dt">&quot;url&quot;</span><span class="fu">:</span> <span class="st">&quot;https://www.iclr.co.uk/document/2019001209/transcriptXml_2019001209_2019092714065099/pdf/download&quot;</span><span class="fu">,</span></span>
<span id="cb1-11"><a href="document-comparison-with-nlp.html#cb1-11"></a>        <span class="dt">&quot;use_fonts&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">10</span><span class="ot">,</span> <span class="dv">13</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-12"><a href="document-comparison-with-nlp.html#cb1-12"></a>        <span class="dt">&quot;page_range&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">2</span><span class="ot">,</span> <span class="st">&quot;Inf&quot;</span><span class="ot">]</span></span>
<span id="cb1-13"><a href="document-comparison-with-nlp.html#cb1-13"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb1-14"><a href="document-comparison-with-nlp.html#cb1-14"></a>    <span class="fu">{</span></span>
<span id="cb1-15"><a href="document-comparison-with-nlp.html#cb1-15"></a>        <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Vodafone Ltd v Office of Communications&quot;</span><span class="fu">,</span></span>
<span id="cb1-16"><a href="document-comparison-with-nlp.html#cb1-16"></a>        <span class="dt">&quot;url&quot;</span><span class="fu">:</span> <span class="st">&quot;https://www.iclr.co.uk/document/2019001384/transcriptXml_2019001384_2019092714070160/pdf/download&quot;</span><span class="fu">,</span></span>
<span id="cb1-17"><a href="document-comparison-with-nlp.html#cb1-17"></a>        <span class="dt">&quot;use_fonts&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">10</span><span class="ot">,</span> <span class="dv">13</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-18"><a href="document-comparison-with-nlp.html#cb1-18"></a>        <span class="dt">&quot;page_range&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">3</span><span class="ot">,</span> <span class="st">&quot;Inf&quot;</span><span class="ot">]</span></span>
<span id="cb1-19"><a href="document-comparison-with-nlp.html#cb1-19"></a>    <span class="fu">}</span></span>
<span id="cb1-20"><a href="document-comparison-with-nlp.html#cb1-20"></a><span class="ot">]</span></span></code></pre></div>
<p>The fields in the JSON are:</p>
<ul>
<li><code>name</code>: The name of the case</li>
<li><code>url</code>: The URL of the PDF document</li>
<li><code>use_fonts</code>: The font heights of the text that this to be processed</li>
<li><code>page_range</code>: The range of pages to process</li>
</ul>
<p>Due to the nature of PDF documents, some preliminary inspection is required to determine the fonts size for the <code>use_fonts</code> field i.e. the text that contains the informative content rather than headers/footers, title, etc. This inspection was performed using the <code>pdf_data</code> function from <code>pdftools</code> package <span class="citation">(Ooms <a href="#ref-R-pdftools" role="doc-biblioref">2020</a>)</span>.</p>
<p>A utility function (<code>extract_text</code>) is defined which takes the fields from the JSON objects as arguments and performs the necessary operations to download the PDF documents and extract the required text. The utility function returns a <code>data.frame</code> with 2 columns:</p>
<ul>
<li><code>doc_id</code>: name of the document.</li>
<li><code>text</code>: text for analysis.</li>
</ul>
<p>The function utility function to each document using the <code>purrr::pmap_df</code> function <span class="citation">(Henry and Wickham <a href="#ref-R-purrr" role="doc-biblioref">2020</a>)</span> resulting in a data frame with <span class="math inline">\(N\)</span> rows where <span class="math inline">\(N\)</span> is the number of documents.</p>
<p>For NLP, the <code>tm</code> package is used <span class="citation">(Feinerer and Hornik <a href="#ref-R-tm" role="doc-biblioref">2019</a> ; Feinerer, Hornik, and Meyer <a href="#ref-tm2008" role="doc-biblioref">2008</a>)</span>. The first stage of analysis is to source the documents and create a corpus object; this is then inspected as a sanity check.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="document-comparison-with-nlp.html#cb2-1"></a><span class="co"># Utility function for reading text specified by JSON.</span></span>
<span id="cb2-2"><a href="document-comparison-with-nlp.html#cb2-2"></a>extract_text &lt;-<span class="st"> </span><span class="cf">function</span>(name, url, <span class="dt">use_fonts =</span> <span class="ot">NULL</span>,</span>
<span id="cb2-3"><a href="document-comparison-with-nlp.html#cb2-3"></a>                         <span class="dt">page_range =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="ot">Inf</span>)) {</span>
<span id="cb2-4"><a href="document-comparison-with-nlp.html#cb2-4"></a></span>
<span id="cb2-5"><a href="document-comparison-with-nlp.html#cb2-5"></a>    <span class="co"># Download files to temporary location.</span></span>
<span id="cb2-6"><a href="document-comparison-with-nlp.html#cb2-6"></a>    destfile =<span class="st"> </span><span class="kw">tempfile</span>(name, <span class="dt">fileext =</span> <span class="st">&#39;.pdf&#39;</span>)</span>
<span id="cb2-7"><a href="document-comparison-with-nlp.html#cb2-7"></a>    <span class="kw">download.file</span>(<span class="dt">url =</span> url, <span class="dt">destfile =</span> destfile, <span class="dt">quiet =</span> <span class="ot">TRUE</span>)</span>
<span id="cb2-8"><a href="document-comparison-with-nlp.html#cb2-8"></a></span>
<span id="cb2-9"><a href="document-comparison-with-nlp.html#cb2-9"></a>    <span class="co"># Filter pages/fonts of interest.</span></span>
<span id="cb2-10"><a href="document-comparison-with-nlp.html#cb2-10"></a>    text &lt;-<span class="st"> </span>pdftools<span class="op">::</span><span class="kw">pdf_data</span>(destfile) <span class="op">%&gt;%</span></span>
<span id="cb2-11"><a href="document-comparison-with-nlp.html#cb2-11"></a><span class="st">        </span>dplyr<span class="op">::</span><span class="kw">bind_rows</span>(<span class="dt">.id =</span> <span class="st">&#39;page&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb2-12"><a href="document-comparison-with-nlp.html#cb2-12"></a><span class="st">        </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">page =</span> <span class="kw">as.integer</span>(page)) <span class="op">%&gt;%</span></span>
<span id="cb2-13"><a href="document-comparison-with-nlp.html#cb2-13"></a><span class="st">        </span>dplyr<span class="op">::</span><span class="kw">filter</span>(<span class="kw">between</span>(page, page_range[<span class="dv">1</span>], page_range[<span class="dv">2</span>]))</span>
<span id="cb2-14"><a href="document-comparison-with-nlp.html#cb2-14"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(use_fonts)) {</span>
<span id="cb2-15"><a href="document-comparison-with-nlp.html#cb2-15"></a>        text &lt;-<span class="st"> </span>text <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-16"><a href="document-comparison-with-nlp.html#cb2-16"></a><span class="st">            </span>dplyr<span class="op">::</span><span class="kw">filter</span>(height <span class="op">%in%</span><span class="st"> </span>use_fonts)</span>
<span id="cb2-17"><a href="document-comparison-with-nlp.html#cb2-17"></a>    }</span>
<span id="cb2-18"><a href="document-comparison-with-nlp.html#cb2-18"></a></span>
<span id="cb2-19"><a href="document-comparison-with-nlp.html#cb2-19"></a>    <span class="co"># Remove temporary files.</span></span>
<span id="cb2-20"><a href="document-comparison-with-nlp.html#cb2-20"></a>    <span class="kw">unlink</span>(destfile)</span>
<span id="cb2-21"><a href="document-comparison-with-nlp.html#cb2-21"></a></span>
<span id="cb2-22"><a href="document-comparison-with-nlp.html#cb2-22"></a>    <span class="co"># Return data frame of text.</span></span>
<span id="cb2-23"><a href="document-comparison-with-nlp.html#cb2-23"></a>    text &lt;-<span class="st"> </span>text <span class="op">%&gt;%</span></span>
<span id="cb2-24"><a href="document-comparison-with-nlp.html#cb2-24"></a><span class="st">        </span>dplyr<span class="op">::</span><span class="kw">pull</span>(text) <span class="op">%&gt;%</span></span>
<span id="cb2-25"><a href="document-comparison-with-nlp.html#cb2-25"></a><span class="st">        </span>stringr<span class="op">::</span><span class="kw">str_c</span>(<span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb2-26"><a href="document-comparison-with-nlp.html#cb2-26"></a>    <span class="kw">data.frame</span>(<span class="dt">doc_id =</span> name, <span class="dt">text =</span> text)</span>
<span id="cb2-27"><a href="document-comparison-with-nlp.html#cb2-27"></a>}</span>
<span id="cb2-28"><a href="document-comparison-with-nlp.html#cb2-28"></a></span>
<span id="cb2-29"><a href="document-comparison-with-nlp.html#cb2-29"></a><span class="co"># Parse JSON text/file.</span></span>
<span id="cb2-30"><a href="document-comparison-with-nlp.html#cb2-30"></a>lst_spec &lt;-<span class="st"> </span>jsonlite<span class="op">::</span><span class="kw">fromJSON</span>(json_spec)</span>
<span id="cb2-31"><a href="document-comparison-with-nlp.html#cb2-31"></a></span>
<span id="cb2-32"><a href="document-comparison-with-nlp.html#cb2-32"></a><span class="co"># Read document texts to data frame.</span></span>
<span id="cb2-33"><a href="document-comparison-with-nlp.html#cb2-33"></a>df_text &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">pmap_df</span>(lst_spec, extract_text)</span>
<span id="cb2-34"><a href="document-comparison-with-nlp.html#cb2-34"></a></span>
<span id="cb2-35"><a href="document-comparison-with-nlp.html#cb2-35"></a><span class="co"># Generate corpus.</span></span>
<span id="cb2-36"><a href="document-comparison-with-nlp.html#cb2-36"></a>corpus &lt;-<span class="st"> </span>tm<span class="op">::</span><span class="kw">DataframeSource</span>(df_text) <span class="op">%&gt;%</span></span>
<span id="cb2-37"><a href="document-comparison-with-nlp.html#cb2-37"></a><span class="st">    </span>tm<span class="op">::</span><span class="kw">VCorpus</span>()</span>
<span id="cb2-38"><a href="document-comparison-with-nlp.html#cb2-38"></a></span>
<span id="cb2-39"><a href="document-comparison-with-nlp.html#cb2-39"></a><span class="co"># Inspect corpus.</span></span>
<span id="cb2-40"><a href="document-comparison-with-nlp.html#cb2-40"></a>corpus <span class="op">%&gt;%</span></span>
<span id="cb2-41"><a href="document-comparison-with-nlp.html#cb2-41"></a><span class="st">    </span>purrr<span class="op">::</span><span class="kw">map_chr</span>(as.character) <span class="op">%&gt;%</span></span>
<span id="cb2-42"><a href="document-comparison-with-nlp.html#cb2-42"></a><span class="st">    </span>purrr<span class="op">::</span><span class="kw">map_chr</span>(str_trunc, <span class="dv">500</span>, <span class="st">&#39;center&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb2-43"><a href="document-comparison-with-nlp.html#cb2-43"></a><span class="st">    </span>purrr<span class="op">::</span><span class="kw">map_chr</span>(str_wrap, <span class="dv">60</span>) <span class="op">%&gt;%</span></span>
<span id="cb2-44"><a href="document-comparison-with-nlp.html#cb2-44"></a><span class="st">    </span><span class="kw">cat</span>(<span class="dt">sep =</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">--------</span><span class="ch">\n</span><span class="st">&#39;</span>)</span></code></pre></div>
<pre><code>## Lord Justice Patten : 1. The School Sites Act 1841 (“the
## 1841 Act”) was passed in order to encourage and facilitate
## the provision of up to one acre of land for use as “a site
## for a school for the education of poor persons, or for the
## residence of th...ayground or for meals. But, in this case,
## the old site remained vacant with no further possible use
## for educational purposes. 24. I would therefore allow the
## appeal. Lord Justice Hamblen : 25. I agree. Lady Justice
## Nicola Davies : 26. I also agree.
## --------
## Lance Ashworth QC: Introduction 1. Because this case
## involves members of the same family, many of them share a
## surname. For the sake of clarity, I shall therefore, without
## intending any disrespect, refer to members of the Kingsley
## family by their gi...unable to agree this. At that hearing
## the parties may make further submissions as to any other
## matters arising out of the accounts for the Partnership as a
## consequence of this judgment and such other matters (if any)
## as cannot be agreed. 1 May 2019
## --------
## ADRIAN BELTRAMI QC: Introduction 1. This is the trial of
## four actions brought under CPR Part 8. The Claimant in
## each action is a Mobile Network Operator and I refer to
## them collectively as the MNOs and individually as Vodafone,
## Telefonica (or O2), H... it helpful, and indeed I think
## it positively unhelpful, for me to express views on these
## issues against a backdrop of conclusions that I have not
## reached. Determination 111. I give Judgment for the MNOs in
## the net sum claimed by each respectively.</code></pre>
</div>
<div id="tidy-corpus" class="section level2">
<h2><span class="header-section-number">1.3</span> Tidy Corpus</h2>
<p>The following transformations are applied to the corpus:</p>
<ul>
<li>Remove punctuation.</li>
<li>Remove ‘stop’ words i.e. articles, pronouns and other common words conveying no information.</li>
<li>Remove numbers.</li>
<li>Reduce words to ‘stems’.</li>
</ul>
<p>The last operation, reducing words to ‘stems’, is worthy of some explanation. Consider the words: ‘regulate’, ‘regulation’, ‘regulatory’. The word <em>stem</em> is ‘regulat’ i.e. the longest chain of common letters. It is often appropriate to aggregate words using their stems for analysis, since the full words are likely to covey similar information in the context of the document. After the transformations have been applied, the corpus is again inspected as a sanity check.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="document-comparison-with-nlp.html#cb4-1"></a><span class="co"># Pre-processing steps.</span></span>
<span id="cb4-2"><a href="document-comparison-with-nlp.html#cb4-2"></a>tidy_corpus &lt;-<span class="st"> </span>corpus <span class="op">%&gt;%</span></span>
<span id="cb4-3"><a href="document-comparison-with-nlp.html#cb4-3"></a><span class="st">    </span>tm<span class="op">::</span><span class="kw">tm_map</span>(tm<span class="op">::</span>stripWhitespace) <span class="op">%&gt;%</span></span>
<span id="cb4-4"><a href="document-comparison-with-nlp.html#cb4-4"></a><span class="st">    </span>tm<span class="op">::</span><span class="kw">tm_map</span>(tm<span class="op">::</span><span class="kw">content_transformer</span>(str_to_lower)) <span class="op">%&gt;%</span></span>
<span id="cb4-5"><a href="document-comparison-with-nlp.html#cb4-5"></a><span class="st">    </span>tm<span class="op">::</span><span class="kw">tm_map</span>(tm<span class="op">::</span>removePunctuation, <span class="dt">ucp =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb4-6"><a href="document-comparison-with-nlp.html#cb4-6"></a><span class="st">    </span>tm<span class="op">::</span><span class="kw">tm_map</span>(tm<span class="op">::</span>removeWords, <span class="kw">c</span>(tm<span class="op">::</span><span class="kw">stopwords</span>(<span class="st">&#39;english&#39;</span>), <span class="st">&#39;x&#39;</span>, <span class="st">&#39;figure&#39;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb4-7"><a href="document-comparison-with-nlp.html#cb4-7"></a><span class="st">    </span>tm<span class="op">::</span><span class="kw">tm_map</span>(tm<span class="op">::</span>removeNumbers)</span>
<span id="cb4-8"><a href="document-comparison-with-nlp.html#cb4-8"></a></span>
<span id="cb4-9"><a href="document-comparison-with-nlp.html#cb4-9"></a><span class="co"># Before stemming, take a copy of the original corpus to un-stem words later.</span></span>
<span id="cb4-10"><a href="document-comparison-with-nlp.html#cb4-10"></a>before_stem_corpus &lt;-<span class="st"> </span>tidy_corpus</span>
<span id="cb4-11"><a href="document-comparison-with-nlp.html#cb4-11"></a>tidy_corpus <span class="op">%&lt;&gt;%</span><span class="st"> </span>tm<span class="op">::</span><span class="kw">tm_map</span>(stemDocument)</span>
<span id="cb4-12"><a href="document-comparison-with-nlp.html#cb4-12"></a></span>
<span id="cb4-13"><a href="document-comparison-with-nlp.html#cb4-13"></a><span class="co"># Inspect tidy corpus.</span></span>
<span id="cb4-14"><a href="document-comparison-with-nlp.html#cb4-14"></a>tidy_corpus <span class="op">%&gt;%</span></span>
<span id="cb4-15"><a href="document-comparison-with-nlp.html#cb4-15"></a><span class="st">    </span>purrr<span class="op">::</span><span class="kw">map_chr</span>(as.character) <span class="op">%&gt;%</span></span>
<span id="cb4-16"><a href="document-comparison-with-nlp.html#cb4-16"></a><span class="st">    </span>purrr<span class="op">::</span><span class="kw">map_chr</span>(str_trunc, <span class="dv">500</span>, <span class="st">&#39;center&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb4-17"><a href="document-comparison-with-nlp.html#cb4-17"></a><span class="st">    </span>purrr<span class="op">::</span><span class="kw">map_chr</span>(str_wrap, <span class="dv">60</span>) <span class="op">%&gt;%</span></span>
<span id="cb4-18"><a href="document-comparison-with-nlp.html#cb4-18"></a><span class="st">    </span><span class="kw">cat</span>(<span class="dt">sep =</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">--------</span><span class="ch">\n</span><span class="st">&#39;</span>)</span></code></pre></div>
<pre><code>## lord justic patten school site act act pass order encourag
## facilit provis one acr land use site school educ poor person
## resid schoolmast schoolmistress otherwis purpos educ poor
## person religi use knowledg major case use provid land local
## church engl...e school use educ purpos requir activ use
## land educ children accept includ ancillari activ use site
## playground meal case old site remain vacant possibl use educ
## purpos therefor allow appeal lord justic hamblen agre ladi
## justic nicola davi also agre
## --------
## lanc ashworth qc introduct case involv member famili mani
## share surnam sake clariti shall therefor without intend
## disrespect refer member kingsley famili given name claim
## brought follow death june roger kingsley roger led automat
## dissolut farm partn...er agreement salli occupi peascroft
## andor peascroft matter conclus will list matter consequenti
## hear counsel can address form order follow parti unabl agre
## hear parti may make submiss matter aris account partnership
## consequ judgment matter agre may
## --------
## adrian beltrami qc introduct trial four action brought cpr
## part claimant action mobil network oper refer collect mnos
## individu vodafon telefonica o hutchison three ee materi
## distinct claim action save respect individu quantum relev
## mno defend case o...di event principl ladi kid appli event
## court appeal found breach eu law found mnos claim succeed
## none point aris determin consid help inde think posit unhelp
## express view issu backdrop conclus reach determin give
## judgment mnos net sum claim respect</code></pre>
</div>
<div id="analsysis" class="section level2">
<h2><span class="header-section-number">1.4</span> Analsysis</h2>
<p>A <em>term-document</em> matrix (TDM) can now be constructed. This is a matrix listing all words in the <em>corpus</em> (the superset of words in all documents) and the frequency with which they occur for each document. Recall, that the processing is done on word <em>stems</em>. Once the processing is complete, the stem is replaced with the most prevalent unstemmed word; this is so that when word clouds are generated later, natural English words are shown rather than stems.</p>
<p>In the chunk below, a TDM object is created and it is also transformed to a data frame for convenience. Ten random rows of the term document data frame are shown below the code chunk.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="document-comparison-with-nlp.html#cb6-1"></a><span class="co"># Compute term document matrix.</span></span>
<span id="cb6-2"><a href="document-comparison-with-nlp.html#cb6-2"></a>tdm &lt;-<span class="st"> </span>tm<span class="op">::</span><span class="kw">TermDocumentMatrix</span>(tidy_corpus)</span>
<span id="cb6-3"><a href="document-comparison-with-nlp.html#cb6-3"></a>tdm<span class="op">$</span>dimnames<span class="op">$</span>Terms &lt;-tm<span class="op">::</span><span class="kw">stemCompletion</span>(tdm<span class="op">$</span>dimnames<span class="op">$</span>Terms,</span>
<span id="cb6-4"><a href="document-comparison-with-nlp.html#cb6-4"></a>                                        before_stem_corpus)</span>
<span id="cb6-5"><a href="document-comparison-with-nlp.html#cb6-5"></a></span>
<span id="cb6-6"><a href="document-comparison-with-nlp.html#cb6-6"></a><span class="co"># Create term document data frame.</span></span>
<span id="cb6-7"><a href="document-comparison-with-nlp.html#cb6-7"></a>df_tdm &lt;-<span class="st"> </span>tdm <span class="op">%&gt;%</span></span>
<span id="cb6-8"><a href="document-comparison-with-nlp.html#cb6-8"></a><span class="st">    </span><span class="kw">as.matrix</span>() <span class="op">%&gt;%</span></span>
<span id="cb6-9"><a href="document-comparison-with-nlp.html#cb6-9"></a><span class="st">    </span>tibble<span class="op">::</span><span class="kw">as_tibble</span>(<span class="dt">rownames =</span> <span class="st">&#39;term&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-10"><a href="document-comparison-with-nlp.html#cb6-10"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">filter</span>(term <span class="op">!=</span><span class="st"> &quot;&quot;</span>)</span>
<span id="cb6-11"><a href="document-comparison-with-nlp.html#cb6-11"></a></span>
<span id="cb6-12"><a href="document-comparison-with-nlp.html#cb6-12"></a><span class="co"># Output head/tail of TDM.</span></span>
<span id="cb6-13"><a href="document-comparison-with-nlp.html#cb6-13"></a>df_tdm <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span>
<span id="cb6-14"><a href="document-comparison-with-nlp.html#cb6-14"></a>df_tdm <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tail</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   term    `Rittson-Thomas v Oxfordsh… `Kingsley v King… `Vodafone Ltd v Office …
##   &lt;chr&gt;                         &lt;dbl&gt;             &lt;dbl&gt;                    &lt;dbl&gt;
## 1 aaron                             0                 2                        0
## 2 able                              1                10                       12
## 3 absence                           0                 0                        2
## 4 absent                            0                 0                        1
## 5 absolu…                           0                 4                        1
## 6 abuts                             0                 1                        0
## # A tibble: 6 x 4
##   term    `Rittson-Thomas v Oxfordsh… `Kingsley v King… `Vodafone Ltd v Office …
##   &lt;chr&gt;                         &lt;dbl&gt;             &lt;dbl&gt;                    &lt;dbl&gt;
## 1 yet                               0                 1                        4
## 2 yieldi…                           0                 0                        1
## 3 young                             1                 0                        0
## 4 younge…                           0                 1                        0
## 5 zealand                           0                 0                        1
## 6 zone                              0                 1                        0</code></pre>
</div>
<div id="exploratory-analysis" class="section level2">
<h2><span class="header-section-number">1.5</span> Exploratory Analysis</h2>
<div id="word-frequency" class="section level3">
<h3><span class="header-section-number">1.5.1</span> Word Frequency</h3>
<p>Figure <a href="document-comparison-with-nlp.html#fig:plt-word-freq">1.1</a> shows the top words in each document as a bar plot. The word frequencies have been normalised by computing the <em>term frequency</em>:</p>
<p><span class="math display">\[
\mathrm{TF}_{i,j} = \frac{N_{i,j}}{\sum_{k=1}^{K} N_{k,j}}.
\]</span></p>
<p><span class="math inline">\(N_{i, j}\)</span> denotes the word count for the <span class="math inline">\(i\)</span>th word in the <span class="math inline">\(j\)</span>th document and <span class="math inline">\(K\)</span> iterates through each word in document <span class="math inline">\(j\)</span>. The normalisation corrects for the fact that word frequencies would be expected to scale with the size of the document which would inflate the perceived importance of the word.</p>

<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="document-comparison-with-nlp.html#cb8-1"></a><span class="co"># Prepare plot data.</span></span>
<span id="cb8-2"><a href="document-comparison-with-nlp.html#cb8-2"></a>df_plt &lt;-<span class="st"> </span>df_tdm <span class="op">%&gt;%</span></span>
<span id="cb8-3"><a href="document-comparison-with-nlp.html#cb8-3"></a><span class="st">    </span>tidyr<span class="op">::</span><span class="kw">pivot_longer</span>(<span class="op">-</span>term, <span class="dt">names_to =</span> <span class="st">&#39;document&#39;</span>, <span class="dt">values_to =</span> <span class="st">&#39;freq&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb8-4"><a href="document-comparison-with-nlp.html#cb8-4"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(document) <span class="op">%&gt;%</span></span>
<span id="cb8-5"><a href="document-comparison-with-nlp.html#cb8-5"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">freq =</span> freq <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(freq)) <span class="op">%&gt;%</span></span>
<span id="cb8-6"><a href="document-comparison-with-nlp.html#cb8-6"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">top_n</span>(<span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">wt =</span> freq) <span class="op">%&gt;%</span></span>
<span id="cb8-7"><a href="document-comparison-with-nlp.html#cb8-7"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">term =</span> tidytext<span class="op">::</span><span class="kw">reorder_within</span>(term, freq, document))</span>
<span id="cb8-8"><a href="document-comparison-with-nlp.html#cb8-8"></a></span>
<span id="cb8-9"><a href="document-comparison-with-nlp.html#cb8-9"></a><span class="co"># Create plot.</span></span>
<span id="cb8-10"><a href="document-comparison-with-nlp.html#cb8-10"></a>ggplot2<span class="op">::</span><span class="kw">ggplot</span>(df_plt, <span class="kw">aes</span>(<span class="dt">x =</span> term, <span class="dt">y =</span> freq, <span class="dt">fill =</span> document)) <span class="op">+</span></span>
<span id="cb8-11"><a href="document-comparison-with-nlp.html#cb8-11"></a><span class="st">    </span>ggplot2<span class="op">::</span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb8-12"><a href="document-comparison-with-nlp.html#cb8-12"></a><span class="st">    </span>ggplot2<span class="op">::</span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb8-13"><a href="document-comparison-with-nlp.html#cb8-13"></a><span class="st">    </span>ggplot2<span class="op">::</span><span class="kw">labs</span>(</span>
<span id="cb8-14"><a href="document-comparison-with-nlp.html#cb8-14"></a>         <span class="dt">x =</span> <span class="st">&#39;Word&#39;</span>,</span>
<span id="cb8-15"><a href="document-comparison-with-nlp.html#cb8-15"></a>         <span class="dt">y =</span> latex2exp<span class="op">::</span><span class="kw">TeX</span>(<span class="st">&#39;Normalised frequency, $</span><span class="ch">\\</span><span class="st">bar{f}$&#39;</span>)) <span class="op">+</span></span>
<span id="cb8-16"><a href="document-comparison-with-nlp.html#cb8-16"></a><span class="st">    </span>tidytext<span class="op">::</span><span class="kw">scale_x_reordered</span>() <span class="op">+</span></span>
<span id="cb8-17"><a href="document-comparison-with-nlp.html#cb8-17"></a><span class="st">    </span>ggplot2<span class="op">::</span><span class="kw">facet_wrap</span>(<span class="op">~</span>document, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&#39;free_y&#39;</span>) <span class="op">+</span></span>
<span id="cb8-18"><a href="document-comparison-with-nlp.html#cb8-18"></a><span class="st">    </span>ggplot2<span class="op">::</span><span class="kw">scale_fill_discrete</span>(<span class="dt">guide=</span><span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb8-19"><a href="document-comparison-with-nlp.html#cb8-19"></a><span class="st">    </span>ggplot2<span class="op">::</span><span class="kw">theme_linedraw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:plt-word-freq"></span>
<img src="01-document-comparison-with-nlp_files/figure-html/plt-word-freq-1.png" alt="Bar plots of term frequencies." width="70%" />
<p class="caption">
Figure 1.1: Bar plots of term frequencies.
</p>
</div>
<p>An alternative way to present this information is as a <em>wordcloud</em>, as shown in figure <a href="document-comparison-with-nlp.html#fig:plt-wordcloud">1.2</a>. Here, the word frequency is mapped to the size of the word depicted in the cloud.</p>

<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="document-comparison-with-nlp.html#cb9-1"></a><span class="co"># Prepare plot data.</span></span>
<span id="cb9-2"><a href="document-comparison-with-nlp.html#cb9-2"></a><span class="kw">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb9-3"><a href="document-comparison-with-nlp.html#cb9-3"></a>df_plt &lt;-<span class="st"> </span>df_tdm <span class="op">%&gt;%</span></span>
<span id="cb9-4"><a href="document-comparison-with-nlp.html#cb9-4"></a><span class="st">    </span>tidyr<span class="op">::</span><span class="kw">pivot_longer</span>(<span class="op">-</span>term, <span class="dt">names_to =</span> <span class="st">&#39;document&#39;</span>, <span class="dt">values_to =</span> <span class="st">&#39;freq&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb9-5"><a href="document-comparison-with-nlp.html#cb9-5"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(document) <span class="op">%&gt;%</span></span>
<span id="cb9-6"><a href="document-comparison-with-nlp.html#cb9-6"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">freq =</span> freq <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(freq)) <span class="op">%&gt;%</span></span>
<span id="cb9-7"><a href="document-comparison-with-nlp.html#cb9-7"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">top_n</span>(<span class="dt">n =</span> <span class="dv">40</span>, <span class="dt">wt =</span> freq) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-8"><a href="document-comparison-with-nlp.html#cb9-8"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">angle =</span> <span class="dv">90</span> <span class="op">*</span><span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="kw">n</span>(), <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="dv">60</span>, <span class="dv">40</span>))) </span>
<span id="cb9-9"><a href="document-comparison-with-nlp.html#cb9-9"></a>    </span>
<span id="cb9-10"><a href="document-comparison-with-nlp.html#cb9-10"></a><span class="co"># Create plot. </span></span>
<span id="cb9-11"><a href="document-comparison-with-nlp.html#cb9-11"></a>ggplot2<span class="op">::</span><span class="kw">ggplot</span>(df_plt, <span class="kw">aes</span>(<span class="dt">label =</span> term, <span class="dt">size =</span> freq, <span class="dt">angle=</span>angle,</span>
<span id="cb9-12"><a href="document-comparison-with-nlp.html#cb9-12"></a>                            <span class="dt">colour =</span> document)) <span class="op">+</span></span>
<span id="cb9-13"><a href="document-comparison-with-nlp.html#cb9-13"></a><span class="st">    </span>ggwordcloud<span class="op">::</span><span class="kw">geom_text_wordcloud</span>(<span class="dt">eccentricity=</span><span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb9-14"><a href="document-comparison-with-nlp.html#cb9-14"></a><span class="st">    </span>ggplot2<span class="op">::</span><span class="kw">coord_equal</span>() <span class="op">+</span></span>
<span id="cb9-15"><a href="document-comparison-with-nlp.html#cb9-15"></a><span class="st">    </span>ggplot2<span class="op">::</span><span class="kw">facet_wrap</span>(<span class="op">~</span>document, <span class="dt">ncol =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb9-16"><a href="document-comparison-with-nlp.html#cb9-16"></a><span class="st">    </span>ggplot2<span class="op">::</span><span class="kw">scale_size_area</span>(<span class="dt">max_size =</span> <span class="dv">10</span>) <span class="op">+</span></span>
<span id="cb9-17"><a href="document-comparison-with-nlp.html#cb9-17"></a><span class="st">    </span>ggplot2<span class="op">::</span><span class="kw">theme_linedraw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:plt-wordcloud"></span>
<img src="01-document-comparison-with-nlp_files/figure-html/plt-wordcloud-1.png" alt="Word cloud for each document." width="100%" />
<p class="caption">
Figure 1.2: Word cloud for each document.
</p>
</div>
<p>These visualisations give a good idea of the keywords associated with each document.</p>
</div>
<div id="commonality-cloud" class="section level3">
<h3><span class="header-section-number">1.5.2</span> Commonality Cloud</h3>
<p>Figure <a href="document-comparison-with-nlp.html#fig:plt-commonality-cloud">1.3</a> shows plots a <em>commonality cloud</em>; this is the combined word cloud for the entire corpus where each term is normalised by the document word count. Therefore, the commonality cloud depicts words that are <em>common</em> across all documents in the corpus. The commonality cloud is plotted using the <code>wordcloud</code> package <span class="citation">(Fellows <a href="#ref-R-wordcloud" role="doc-biblioref">2018</a>)</span>.</p>

<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="document-comparison-with-nlp.html#cb10-1"></a>mat_plt &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(tdm)</span>
<span id="cb10-2"><a href="document-comparison-with-nlp.html#cb10-2"></a>wordcloud<span class="op">::</span><span class="kw">commonality.cloud</span>(mat_plt, <span class="dt">max.words =</span> <span class="dv">50</span>) </span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:plt-commonality-cloud"></span>
<img src="01-document-comparison-with-nlp_files/figure-html/plt-commonality-cloud-1.png" alt="Commonality cloud." width="70%" />
<p class="caption">
Figure 1.3: Commonality cloud.
</p>
</div>
<p>The common words identified seem reasonable; the majority relate to general vocabulary that would be expected in legal proceedings.</p>
</div>
<div id="comparison-cloud" class="section level3">
<h3><span class="header-section-number">1.5.3</span> Comparison Cloud</h3>
<p>Figure <a href="document-comparison-with-nlp.html#fig:plt-comparison-cloud">1.4</a> shows a <em>comparison cloud</em>. Contrary to the <em>commonality</em> cloud empathising <em>similarities</em>, the <em>comparison</em> cloud emphasises <em>differences</em> in. Let <span class="math inline">\(f_{i,j}\)</span> be the frequency of word <span class="math inline">\(i\)</span> in document <span class="math inline">\(j\)</span> and let <span class="math inline">\(\bar{p}_i\)</span> be the average frequency of word <span class="math inline">\(i\)</span> in the corpus i.e.</p>
<p><span class="math display">\[
\bar{p}_i = \frac{1}{J}\sum_{j=1}^{J} f_{i,j}.
\]</span></p>
<p>where <span class="math inline">\(J\)</span> number of documents in the corpus. Then, in the <em>comparison cloud</em>, the size of of the word is mapped to the maximum deviation i.e. <span class="math inline">\(\max_i(p_{i,j}-\bar{p}_i)\)</span> and the position corresponds to the document in which the maximum occurs. In other words, the words shown are cases where a particular document contains many instances of the word whereas the other documents do not. The comparison cloud is plotted using the <code>wordcloud</code> package <span class="citation">(Fellows <a href="#ref-R-wordcloud" role="doc-biblioref">2018</a>)</span>.</p>

<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="document-comparison-with-nlp.html#cb11-1"></a>mat_plt &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(tdm)</span>
<span id="cb11-2"><a href="document-comparison-with-nlp.html#cb11-2"></a></span>
<span id="cb11-3"><a href="document-comparison-with-nlp.html#cb11-3"></a><span class="co"># Compute colour scheme to match ggplot.</span></span>
<span id="cb11-4"><a href="document-comparison-with-nlp.html#cb11-4"></a>gg_color_hue &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</span>
<span id="cb11-5"><a href="document-comparison-with-nlp.html#cb11-5"></a>  hues =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">15</span>, <span class="dv">375</span>, <span class="dt">length =</span> n <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb11-6"><a href="document-comparison-with-nlp.html#cb11-6"></a>  <span class="kw">hcl</span>(<span class="dt">h =</span> hues, <span class="dt">l =</span> <span class="dv">65</span>, <span class="dt">c =</span> <span class="dv">100</span>)[<span class="dv">1</span><span class="op">:</span>n]</span>
<span id="cb11-7"><a href="document-comparison-with-nlp.html#cb11-7"></a>}</span>
<span id="cb11-8"><a href="document-comparison-with-nlp.html#cb11-8"></a>colors =<span class="st"> </span><span class="kw">gg_color_hue</span>(<span class="dv">3</span>)</span>
<span id="cb11-9"><a href="document-comparison-with-nlp.html#cb11-9"></a></span>
<span id="cb11-10"><a href="document-comparison-with-nlp.html#cb11-10"></a><span class="co"># Plot comparison cloud.</span></span>
<span id="cb11-11"><a href="document-comparison-with-nlp.html#cb11-11"></a><span class="kw">colnames</span>(mat_plt) &lt;-<span class="st"> </span><span class="kw">colnames</span>(mat_plt) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_replace</span>(<span class="st">&quot;v&quot;</span>, <span class="st">&quot;v</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb11-12"><a href="document-comparison-with-nlp.html#cb11-12"></a>wordcloud<span class="op">::</span><span class="kw">comparison.cloud</span>(mat_plt, <span class="dt">scale =</span> <span class="kw">c</span>(<span class="dv">6</span>, <span class="fl">.2</span>),</span>
<span id="cb11-13"><a href="document-comparison-with-nlp.html#cb11-13"></a>                            <span class="dt">colors =</span> colors, <span class="dt">max.words =</span> <span class="dv">50</span>,</span>
<span id="cb11-14"><a href="document-comparison-with-nlp.html#cb11-14"></a>                            <span class="dt">title.size =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:plt-comparison-cloud"></span>
<img src="01-document-comparison-with-nlp_files/figure-html/plt-comparison-cloud-1.png" alt="Comparison cloud." width="90%" />
<p class="caption">
Figure 1.4: Comparison cloud.
</p>
</div>
<p>This analysis is consistent with the keywords derived from the word frequency analysis, however, keywords that are common between documents are suppressed i.e. are either not shown or are relatively smaller in size.</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-tm">
<p>Feinerer, Ingo, and Kurt Hornik. 2019. <em>Tm: Text Mining Package</em>. <a href="https://CRAN.R-project.org/package=tm">https://CRAN.R-project.org/package=tm</a>.</p>
</div>
<div id="ref-tm2008">
<p>Feinerer, Ingo, Kurt Hornik, and David Meyer. 2008. “Text Mining Infrastructure in R.” <em>Journal of Statistical Software</em> 25 (5): 1–54. <a href="http://www.jstatsoft.org/v25/i05/">http://www.jstatsoft.org/v25/i05/</a>.</p>
</div>
<div id="ref-R-wordcloud">
<p>Fellows, Ian. 2018. <em>Wordcloud: Word Clouds</em>. <a href="https://CRAN.R-project.org/package=wordcloud">https://CRAN.R-project.org/package=wordcloud</a>.</p>
</div>
<div id="ref-R-purrr">
<p>Henry, Lionel, and Hadley Wickham. 2020. <em>Purrr: Functional Programming Tools</em>. <a href="https://CRAN.R-project.org/package=purrr">https://CRAN.R-project.org/package=purrr</a>.</p>
</div>
<div id="ref-R-pdftools">
<p>Ooms, Jeroen. 2020. <em>Pdftools: Text Extraction, Rendering and Converting of Pdf Documents</em>. <a href="https://CRAN.R-project.org/package=pdftools">https://CRAN.R-project.org/package=pdftools</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="website-comparison-with-nlp.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
