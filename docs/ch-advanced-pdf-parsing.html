<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Advanced PDF Parsing | Applied NLP for Document Analysis</title>
  <meta name="description" content="Bookdown report with examples of applied NLP for document analysis" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Advanced PDF Parsing | Applied NLP for Document Analysis" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://https://nickptaylor.github.io/nlp-document-analysis/" />
  
  <meta property="og:description" content="Bookdown report with examples of applied NLP for document analysis" />
  <meta name="github-repo" content="nickptaylor/nlp-document-analysis" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Advanced PDF Parsing | Applied NLP for Document Analysis" />
  
  <meta name="twitter:description" content="Bookdown report with examples of applied NLP for document analysis" />
  

<meta name="author" content="Nick P Taylor" />


<meta name="date" content="2020-06-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="website-comparison-with-nlp.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied NLP for Document Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="document-comparison-with-nlp.html"><a href="document-comparison-with-nlp.html"><i class="fa fa-check"></i><b>1</b> Document Comparison with NLP</a><ul>
<li class="chapter" data-level="1.1" data-path="document-comparison-with-nlp.html"><a href="document-comparison-with-nlp.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="document-comparison-with-nlp.html"><a href="document-comparison-with-nlp.html#read-document"><i class="fa fa-check"></i><b>1.2</b> Read Document</a></li>
<li class="chapter" data-level="1.3" data-path="document-comparison-with-nlp.html"><a href="document-comparison-with-nlp.html#tidy-corpus"><i class="fa fa-check"></i><b>1.3</b> Tidy Corpus</a></li>
<li class="chapter" data-level="1.4" data-path="document-comparison-with-nlp.html"><a href="document-comparison-with-nlp.html#analysis"><i class="fa fa-check"></i><b>1.4</b> Analysis</a></li>
<li class="chapter" data-level="1.5" data-path="document-comparison-with-nlp.html"><a href="document-comparison-with-nlp.html#exploratory-analysis"><i class="fa fa-check"></i><b>1.5</b> Exploratory Analysis</a><ul>
<li class="chapter" data-level="1.5.1" data-path="document-comparison-with-nlp.html"><a href="document-comparison-with-nlp.html#word-frequency"><i class="fa fa-check"></i><b>1.5.1</b> Word Frequency</a></li>
<li class="chapter" data-level="1.5.2" data-path="document-comparison-with-nlp.html"><a href="document-comparison-with-nlp.html#commonality-cloud"><i class="fa fa-check"></i><b>1.5.2</b> Commonality Cloud</a></li>
<li class="chapter" data-level="1.5.3" data-path="document-comparison-with-nlp.html"><a href="document-comparison-with-nlp.html#comparison-cloud"><i class="fa fa-check"></i><b>1.5.3</b> Comparison Cloud</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="website-comparison-with-nlp.html"><a href="website-comparison-with-nlp.html"><i class="fa fa-check"></i><b>2</b> Website Comparison with NLP</a><ul>
<li class="chapter" data-level="2.1" data-path="website-comparison-with-nlp.html"><a href="website-comparison-with-nlp.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="website-comparison-with-nlp.html"><a href="website-comparison-with-nlp.html#web-scraping"><i class="fa fa-check"></i><b>2.2</b> Web Scraping</a></li>
<li class="chapter" data-level="2.3" data-path="website-comparison-with-nlp.html"><a href="website-comparison-with-nlp.html#tokenisation"><i class="fa fa-check"></i><b>2.3</b> Tokenisation</a></li>
<li class="chapter" data-level="2.4" data-path="website-comparison-with-nlp.html"><a href="website-comparison-with-nlp.html#ssec:tfidf"><i class="fa fa-check"></i><b>2.4</b> Term-frequency Inverse Document-Frequency</a></li>
<li class="chapter" data-level="2.5" data-path="website-comparison-with-nlp.html"><a href="website-comparison-with-nlp.html#exploratory-analysis-1"><i class="fa fa-check"></i><b>2.5</b> Exploratory Analysis</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ch-advanced-pdf-parsing.html"><a href="ch-advanced-pdf-parsing.html"><i class="fa fa-check"></i><b>3</b> Advanced PDF Parsing</a><ul>
<li class="chapter" data-level="3.1" data-path="ch-advanced-pdf-parsing.html"><a href="ch-advanced-pdf-parsing.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a><ul>
<li class="chapter" data-level="3.1.1" data-path="ch-advanced-pdf-parsing.html"><a href="ch-advanced-pdf-parsing.html#objective"><i class="fa fa-check"></i><b>3.1.1</b> Objective</a></li>
<li class="chapter" data-level="3.1.2" data-path="ch-advanced-pdf-parsing.html"><a href="ch-advanced-pdf-parsing.html#html-documents"><i class="fa fa-check"></i><b>3.1.2</b> HTML Documents</a></li>
<li class="chapter" data-level="3.1.3" data-path="ch-advanced-pdf-parsing.html"><a href="ch-advanced-pdf-parsing.html#pdf-documents"><i class="fa fa-check"></i><b>3.1.3</b> PDF Documents</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="ch-advanced-pdf-parsing.html"><a href="ch-advanced-pdf-parsing.html#method"><i class="fa fa-check"></i><b>3.2</b> Method</a><ul>
<li class="chapter" data-level="3.2.1" data-path="ch-advanced-pdf-parsing.html"><a href="ch-advanced-pdf-parsing.html#read-document-1"><i class="fa fa-check"></i><b>3.2.1</b> Read Document</a></li>
<li class="chapter" data-level="3.2.2" data-path="ch-advanced-pdf-parsing.html"><a href="ch-advanced-pdf-parsing.html#identify-headings"><i class="fa fa-check"></i><b>3.2.2</b> Identify Headings</a></li>
<li class="chapter" data-level="3.2.3" data-path="ch-advanced-pdf-parsing.html"><a href="ch-advanced-pdf-parsing.html#corpus-by-heading"><i class="fa fa-check"></i><b>3.2.3</b> Corpus by Heading</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="ch-advanced-pdf-parsing.html"><a href="ch-advanced-pdf-parsing.html#conclusion"><i class="fa fa-check"></i><b>3.3</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applied NLP for Document Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ch:advanced-pdf-parsing" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Advanced PDF Parsing</h1>
<div id="introduction-2" class="section level2">
<h2><span class="header-section-number">3.1</span> Introduction</h2>
<div id="objective" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Objective</h3>
<p>This report addresses the objective:</p>
<blockquote>
<p>Given a large PDF document with several chapters/sections, apply NLP (Natural Language Processing) techniques to each <em>section</em> in order to gain insight into the content of each section.</p>
</blockquote>
<p>The document being considered for this example is <a href="https://www.williamshakespeare.net/pdf/macbeth.pdf">Shakespeare’s Macbeth</a> and the objective is to split the document into a corpus of sections.</p>
</div>
<div id="html-documents" class="section level3">
<h3><span class="header-section-number">3.1.2</span> HTML Documents</h3>
<p>Parsing an HTML (Hyper-text Markup Language) document i.e. a web page by section is relatively easy since the HTML markup language explicitly encodes the structure of the document i.e. HTML directly specifies whether each item of text is a heading, paragraph, list, etc. Headings are typically enclosed by one of six HTML markup tags i.e. <code>&lt;h1&gt;</code>, <code>&lt;h2&gt;</code>, etc. wherein the number succeeding the ‘h’ reflects the hierarchical importance of the heading. For example, <code>&lt;h1&gt;</code> tags may reflect a ‘title’ heading, <code>&lt;h1&gt;</code> a ‘chapter’, <code>&lt;h2&gt;</code> a section and so forth. HTML only describes the <em>structure</em> of the document; the <em>formatting</em> of the document, describing how the text is rendered is (usually) described elsewhere e.g. a CSS (Cascading Style Sheet) file.</p>
</div>
<div id="pdf-documents" class="section level3">
<h3><span class="header-section-number">3.1.3</span> PDF Documents</h3>
<p>The raw encoding for a PDF document is fundamentally different to that of an HTML document. Whereas the raw code for HTML contains the document content and explicit encoding of the document <em>structure</em>, a PDF document describes the content and the <em>formatting</em> e.g. font style, font size, character location, etc. The structure is therefore implicit, rather than explicit and it is only possible to <em>infer</em> the structural aspects of the document from the code describing the formatting of the document. For example, if an item of text is formatted to be rendered with a large font, it could be inferred that the text is a ‘title’ heading. In this report, a method for parsing a PDF document will be described. The method is facilitated by the <code>pdftools</code> package <span class="citation">(Ooms <a href="#ref-R-pdftools" role="doc-biblioref">2020</a>)</span><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
</div>
</div>
<div id="method" class="section level2">
<h2><span class="header-section-number">3.2</span> Method</h2>
<div id="read-document-1" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Read Document</h3>
<p>Using <code>pdftools::pdf_data</code> the document is read, word-by-word. For later convenience, the document <em>line number</em> of each word is computed and included with the data. The first and last words of extracted raw data are inspected:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="ch-advanced-pdf-parsing.html#cb26-1"></a><span class="co"># Download document to temporary location.</span></span>
<span id="cb26-2"><a href="ch-advanced-pdf-parsing.html#cb26-2"></a>destfile =<span class="st"> </span><span class="kw">tempfile</span>(<span class="st">&#39;macbeth&#39;</span>, <span class="dt">fileext =</span> <span class="st">&#39;.pdf&#39;</span>)</span>
<span id="cb26-3"><a href="ch-advanced-pdf-parsing.html#cb26-3"></a><span class="kw">download.file</span>(<span class="dt">url =</span> <span class="st">&#39;https://www.williamshakespeare.net/pdf/macbeth.pdf&#39;</span>,</span>
<span id="cb26-4"><a href="ch-advanced-pdf-parsing.html#cb26-4"></a>              <span class="dt">destfile =</span> destfile, <span class="dt">quiet =</span> <span class="ot">TRUE</span>)</span>
<span id="cb26-5"><a href="ch-advanced-pdf-parsing.html#cb26-5"></a></span>
<span id="cb26-6"><a href="ch-advanced-pdf-parsing.html#cb26-6"></a><span class="co"># Read metadata.</span></span>
<span id="cb26-7"><a href="ch-advanced-pdf-parsing.html#cb26-7"></a>df_doc_data_raw &lt;-<span class="st"> </span>pdftools<span class="op">::</span><span class="kw">pdf_data</span>(destfile) <span class="op">%&gt;%</span></span>
<span id="cb26-8"><a href="ch-advanced-pdf-parsing.html#cb26-8"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">bind_rows</span>(<span class="dt">.id =</span> <span class="st">&#39;page&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb26-9"><a href="ch-advanced-pdf-parsing.html#cb26-9"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">page =</span> <span class="kw">as.integer</span>(page)) <span class="op">%&gt;%</span></span>
<span id="cb26-10"><a href="ch-advanced-pdf-parsing.html#cb26-10"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">text =</span> text <span class="op">%&gt;%</span></span>
<span id="cb26-11"><a href="ch-advanced-pdf-parsing.html#cb26-11"></a><span class="st">        </span>stringr<span class="op">::</span><span class="kw">str_remove_all</span>(<span class="st">&#39;[^[:print:]]+&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb26-12"><a href="ch-advanced-pdf-parsing.html#cb26-12"></a><span class="st">        </span>stringr<span class="op">::</span><span class="kw">str_squish</span>())</span>
<span id="cb26-13"><a href="ch-advanced-pdf-parsing.html#cb26-13"></a></span>
<span id="cb26-14"><a href="ch-advanced-pdf-parsing.html#cb26-14"></a><span class="co"># Remove temporary file.</span></span>
<span id="cb26-15"><a href="ch-advanced-pdf-parsing.html#cb26-15"></a><span class="kw">unlink</span>(destfile)</span>
<span id="cb26-16"><a href="ch-advanced-pdf-parsing.html#cb26-16"></a></span>
<span id="cb26-17"><a href="ch-advanced-pdf-parsing.html#cb26-17"></a><span class="co"># Compute line numbers.</span></span>
<span id="cb26-18"><a href="ch-advanced-pdf-parsing.html#cb26-18"></a>line_no &lt;-<span class="st"> </span>df_doc_data_raw <span class="op">%&gt;%</span></span>
<span id="cb26-19"><a href="ch-advanced-pdf-parsing.html#cb26-19"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">distinct</span>(page, y) <span class="op">%&gt;%</span></span>
<span id="cb26-20"><a href="ch-advanced-pdf-parsing.html#cb26-20"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">arrange</span>(page, y) <span class="op">%&gt;%</span></span>
<span id="cb26-21"><a href="ch-advanced-pdf-parsing.html#cb26-21"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">doc_line =</span> <span class="kw">row_number</span>())</span>
<span id="cb26-22"><a href="ch-advanced-pdf-parsing.html#cb26-22"></a></span>
<span id="cb26-23"><a href="ch-advanced-pdf-parsing.html#cb26-23"></a>df_doc_data_raw <span class="op">%&lt;&gt;%</span></span>
<span id="cb26-24"><a href="ch-advanced-pdf-parsing.html#cb26-24"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">left_join</span>(line_no, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;page&#39;</span>, <span class="st">&#39;y&#39;</span>))</span>
<span id="cb26-25"><a href="ch-advanced-pdf-parsing.html#cb26-25"></a></span>
<span id="cb26-26"><a href="ch-advanced-pdf-parsing.html#cb26-26"></a><span class="co"># Print.</span></span>
<span id="cb26-27"><a href="ch-advanced-pdf-parsing.html#cb26-27"></a>df_doc_data_raw <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span>
<span id="cb26-28"><a href="ch-advanced-pdf-parsing.html#cb26-28"></a>df_doc_data_raw <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tail</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 8
##    page width height     x     y space text     doc_line
##   &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;lgl&gt; &lt;chr&gt;       &lt;int&gt;
## 1     1    48     11   458    38 TRUE  HAMLET          1
## 2     1     3     11   510    38 TRUE  -               1
## 3     1    17     11   517    38 TRUE  Act             1
## 4     1     8     11   538    38 FALSE V               1
## 5     1     6     11   535   794 FALSE 1               2
## 6     2    58     15    54    81 FALSE Contents        3
## # A tibble: 6 x 8
##    page width height     x     y space text      doc_line
##   &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;lgl&gt; &lt;chr&gt;        &lt;int&gt;
## 1    83    42     12   197   476 TRUE  crown&#39;d       3360
## 2    83     9     12   244   476 TRUE  at            3360
## 3    83    36     12   257   476 FALSE Scone.        3360
## 4    83    50     12    54   505 TRUE  Flourish.     3361
## 5    83    37     12   108   505 FALSE Exeunt        3361
## 6    83    13     11   529   794 FALSE 83            3362</code></pre>
<p>The extracted metadata is:</p>
<ul>
<li><code>text</code>: the word</li>
<li><code>page</code>: the page that the word occurs on</li>
<li><code>width</code>: the width of the word i.e. font width</li>
<li><code>height</code>: the height of the word i.e. font height</li>
<li><code>x</code>: the horizontal location of the word on the page</li>
<li><code>y</code>: the vertical location of the word on the page</li>
<li><code>space</code>: whether the word should have a space appended</li>
</ul>
<p>The line number, <code>doc_line</code>, is computed from the raw metadata by identifying unique combinations of <code>page</code> and <code>y</code>. As stated above, the word metadata demonstrates that the internal representation of a PDF combines the description of the <em>formatting</em> and the <em>content</em> and does not explicitly describe the <em>structure</em>.</p>
</div>
<div id="identify-headings" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Identify Headings</h3>
<p>It may be possible to extract further metadata relating to each word such as font type; however, this has not been explored presently. For the method described herein, the word <em>height</em> is used to identify candidate words that <em>may</em> be section heading content. Some exploration indicated that words that are of height 22 are likely to be section headings for the document being analysed:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="ch-advanced-pdf-parsing.html#cb28-1"></a>df_doc_data_raw <span class="op">%&gt;%</span></span>
<span id="cb28-2"><a href="ch-advanced-pdf-parsing.html#cb28-2"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">filter</span>(height <span class="op">==</span><span class="st"> </span>HEADING_SIZE)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 8
##     page width height     x     y space text  doc_line
##    &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;lgl&gt; &lt;chr&gt;    &lt;int&gt;
##  1     3    47     22    54    56 TRUE  ACT         38
##  2     3     6     22   108    56 FALSE I           38
##  3    20    47     22    54   116 TRUE  ACT        751
##  4    20    13     22   108   116 FALSE II         751
##  5    34    47     22    54   239 TRUE  ACT       1322
##  6    34    20     22   108   239 FALSE III       1322
##  7    51    47     22    54    71 TRUE  ACT       2019
##  8    51    22     22   108    71 FALSE IV        2019
##  9    69    47     22    54   229 TRUE  ACT       2779
## 10    69    16     22   108   229 FALSE V         2779</code></pre>
<p>The raw data frame contains a row for each word. The objective of the following code is to traverse the data frame above and derive groups of words that form each individual section heading. This is achieved by first filtering words that have the section heading height. Subsequently, by joining these filtered words that either occur on the same line or on consecutive lines, section headings can be inferred. It is necessary to consider consecutive lines since it is possible that long section headings contain a line break although this does not occur in the current document.</p>
<p>The procedure in the code block below is:</p>
<ul>
<li>Filter words with a height matching the section heading height.</li>
<li>Identify whether the words in the next row(s) are also part of the same heading i.e. on the same or consecutive lines in the document.</li>
<li>Assign a unique ID to words belonging to the same heading.</li>
<li>Concatenate words belonging to the same heading.</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="ch-advanced-pdf-parsing.html#cb30-1"></a><span class="co"># Derive headings.</span></span>
<span id="cb30-2"><a href="ch-advanced-pdf-parsing.html#cb30-2"></a>df_headings &lt;-<span class="st"> </span>df_doc_data_raw <span class="op">%&gt;%</span></span>
<span id="cb30-3"><a href="ch-advanced-pdf-parsing.html#cb30-3"></a><span class="st">    </span><span class="co"># Filter words that make up headings.</span></span>
<span id="cb30-4"><a href="ch-advanced-pdf-parsing.html#cb30-4"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">filter</span>(height <span class="op">==</span><span class="st"> </span>HEADING_SIZE) <span class="op">%&gt;%</span></span>
<span id="cb30-5"><a href="ch-advanced-pdf-parsing.html#cb30-5"></a><span class="st">    </span><span class="co"># Group words that form each heading and assign head_ID.</span></span>
<span id="cb30-6"><a href="ch-advanced-pdf-parsing.html#cb30-6"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">doc_line_diff =</span> doc_line <span class="op">-</span><span class="st"> </span><span class="kw">lag</span>(doc_line)) <span class="op">%&gt;%</span></span>
<span id="cb30-7"><a href="ch-advanced-pdf-parsing.html#cb30-7"></a><span class="st">    </span>tidyr<span class="op">::</span><span class="kw">replace_na</span>(<span class="kw">list</span>(<span class="dt">doc_line_diff =</span> <span class="dv">-1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb30-8"><a href="ch-advanced-pdf-parsing.html#cb30-8"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">head_id =</span> <span class="kw">cumsum</span>(doc_line_diff <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb30-9"><a href="ch-advanced-pdf-parsing.html#cb30-9"></a><span class="st">    </span><span class="co"># Concatenate words with the same head_ID.</span></span>
<span id="cb30-10"><a href="ch-advanced-pdf-parsing.html#cb30-10"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(head_id) <span class="op">%&gt;%</span></span>
<span id="cb30-11"><a href="ch-advanced-pdf-parsing.html#cb30-11"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">summarise</span>(<span class="dt">doc_line =</span> <span class="kw">first</span>(doc_line),</span>
<span id="cb30-12"><a href="ch-advanced-pdf-parsing.html#cb30-12"></a>                     <span class="dt">page =</span> <span class="kw">first</span>(page),</span>
<span id="cb30-13"><a href="ch-advanced-pdf-parsing.html#cb30-13"></a>                     <span class="dt">heading =</span> <span class="kw">str_c</span>(text, <span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>), <span class="dt">.groups =</span> <span class="st">&#39;drop&#39;</span>)</span>
<span id="cb30-14"><a href="ch-advanced-pdf-parsing.html#cb30-14"></a></span>
<span id="cb30-15"><a href="ch-advanced-pdf-parsing.html#cb30-15"></a>df_headings</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##   head_id doc_line  page heading
##     &lt;int&gt;    &lt;int&gt; &lt;int&gt; &lt;chr&gt;  
## 1       0       38     3 ACT I  
## 2       1      751    20 ACT II 
## 3       2     1322    34 ACT III
## 4       3     2019    51 ACT IV 
## 5       4     2779    69 ACT V</code></pre>
<p>The reader may refer to the <a href="https://www.williamshakespeare.net/pdf/macbeth.pdf">imported document</a>, to confirm that the section headings are correctly captured here. The section heading words can now be joined to the raw data. The procedure in the following code chunk is:</p>
<ul>
<li>Select the required metadata.</li>
<li>Join the section headings derived above to the first word of each section in the raw data.</li>
<li>Fill the section headings forwards so that the text between heading A and heading B is assigned to heading A.</li>
</ul>
<p>Note that the last page (of the last section) should be assigned otherwise the last the section will be assumed to continue until the end of the text.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="ch-advanced-pdf-parsing.html#cb32-1"></a><span class="co"># Assign headings to raw data.</span></span>
<span id="cb32-2"><a href="ch-advanced-pdf-parsing.html#cb32-2"></a>df_doc_data &lt;-<span class="st"> </span>df_doc_data_raw <span class="op">%&gt;%</span></span>
<span id="cb32-3"><a href="ch-advanced-pdf-parsing.html#cb32-3"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(page, doc_line, text) <span class="op">%&gt;%</span></span>
<span id="cb32-4"><a href="ch-advanced-pdf-parsing.html#cb32-4"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">filter</span>(page <span class="op">&lt;=</span><span class="st"> </span>LAST_PAGE) <span class="op">%&gt;%</span></span>
<span id="cb32-5"><a href="ch-advanced-pdf-parsing.html#cb32-5"></a><span class="st">    </span><span class="co"># Merge headings.</span></span>
<span id="cb32-6"><a href="ch-advanced-pdf-parsing.html#cb32-6"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">left_join</span>(df_headings, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;page&#39;</span>, <span class="st">&#39;doc_line&#39;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb32-7"><a href="ch-advanced-pdf-parsing.html#cb32-7"></a><span class="st">    </span><span class="co"># Fill headings forward</span></span>
<span id="cb32-8"><a href="ch-advanced-pdf-parsing.html#cb32-8"></a><span class="st">    </span>tidyr<span class="op">::</span><span class="kw">fill</span>(heading, head_id) <span class="op">%&gt;%</span></span>
<span id="cb32-9"><a href="ch-advanced-pdf-parsing.html#cb32-9"></a><span class="st">    </span>tidyr<span class="op">::</span><span class="kw">drop_na</span>()</span></code></pre></div>
</div>
<div id="corpus-by-heading" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Corpus by Heading</h3>
<p>Finally, the data frame is grouped by section and the words within the section are concatenated to form the document corpus.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="ch-advanced-pdf-parsing.html#cb33-1"></a>df_corpus &lt;-<span class="st"> </span>df_doc_data <span class="op">%&gt;%</span></span>
<span id="cb33-2"><a href="ch-advanced-pdf-parsing.html#cb33-2"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(heading) <span class="op">%&gt;%</span></span>
<span id="cb33-3"><a href="ch-advanced-pdf-parsing.html#cb33-3"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">corpus =</span> text <span class="op">%&gt;%</span></span>
<span id="cb33-4"><a href="ch-advanced-pdf-parsing.html#cb33-4"></a><span class="st">        </span><span class="kw">str_c</span>(<span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb33-5"><a href="ch-advanced-pdf-parsing.html#cb33-5"></a><span class="st">        </span>stringr<span class="op">::</span><span class="kw">str_trunc</span>(<span class="dv">500</span>, <span class="st">&#39;center&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb33-6"><a href="ch-advanced-pdf-parsing.html#cb33-6"></a><span class="st">        </span>stringr<span class="op">::</span><span class="kw">str_wrap</span>(), <span class="dt">.groups =</span> <span class="st">&#39;drop&#39;</span>)</span>
<span id="cb33-7"><a href="ch-advanced-pdf-parsing.html#cb33-7"></a></span>
<span id="cb33-8"><a href="ch-advanced-pdf-parsing.html#cb33-8"></a><span class="kw">cat</span>(df_corpus<span class="op">$</span>corpus, <span class="dt">sep =</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">--------</span><span class="ch">\n</span><span class="st">&#39;</span>)</span></code></pre></div>
<pre><code>## ACT I SCENE I. A desert place. Thunder and lightning. Enter three Witches First
## Witch When shall we three meet again In thunder, lightning, or in rain? Second
## Witch When the hurlyburly&#39;s done, When the battle&#39;s lost and won. Third Witch
## That will be...her, As we shall make our griefs and clamour roar Upon his death?
## MACBETH I am settled, and bend up Each corporal agent to this terrible feat. 19
## Away, and mock the time with fairest show: False face must hide what the false
## heart doth know. Exeunt
## --------
## ACT II SCENE I. Court of Macbeth&#39;s castle. Enter BANQUO, and FLEANCE bearing
## a torch before him BANQUO How goes the night, boy? FLEANCE The moon is down; I
## have not heard the clock. BANQUO And she goes down at twelve. FLEANCE I take&#39;t,
## &#39;tis later, s..., I will thither. MACDUFF Well, may you see things well done
## there: adieu! Lest our old robes sit easier than our new! ROSS Farewell, father.
## Old Man God&#39;s benison go with you; and with those That would make good of bad,
## and friends of foes! Exeunt
## --------
## ACT III SCENE I. Forres. The palace. Enter BANQUO BANQUO Thou hast it now: king,
## Cawdor, Glamis, all, As the weird women promised, and, I fear, Thou play&#39;dst
## most foully for&#39;t: yet it was said It should not stand in thy posterity, But
## that myself sh...istance His wisdom can provide. Some holy angel Fly to the
## court of England and unfold His message ere he come, that a swift blessing May
## soon return to this our suffering country Under a hand accursed! Lord I&#39;ll send
## my prayers with him. 50 Exeunt
## --------
## ACT IV SCENE I. A cavern. In the middle, a boiling cauldron. Thunder. Enter the
## three Witches First Witch Thrice the brinded cat hath mew&#39;d. Second Witch Thrice
## and once the hedge-pig whined. Third Witch Harpier cries &#39;Tis time, &#39;tis time.
## First Wit...e goes manly. Come, go we to the king; our power is ready; Our lack
## is nothing but our leave; Macbeth Is ripe for shaking, and the powers above Put
## on their instruments. Receive what cheer you may: The night is long that never
## finds the day. Exeunt
## --------
## ACT V SCENE I. Dunsinane. Ante-room in the castle. Enter a Doctor of Physic
## and a Waiting-Gentlewoman Doctor I have two nights watched with you, but can
## perceive no truth in your report. When was it she last walked? Gentlewoman
## Since his majesty wen...nt hands Took off her life; this, and what needful else
## That calls upon us, by the grace of Grace, We will perform in measure, time
## and place: So, thanks to all at once and to each one, Whom we invite to see us
## crown&#39;d at Scone. Flourish. Exeunt 83</code></pre>
<p>The data is now in a form whereby NLP (Natural Language Processing) methods can by applied by section.</p>
</div>
</div>
<div id="conclusion" class="section level2">
<h2><span class="header-section-number">3.3</span> Conclusion</h2>
<p>It is possible to infer PDF section headings by manipulating the metadata available from the PDF encoding. It is considerably more challenging to traverse the section hierarchy of PDF documents than HTML documents. The method described herein requires assumptions and interpretations in order to infer what text is a section heading and what the hierarchy is. In contrast, markup tags make this explicit in HTML documents. For section-by-section processing of a PDF document, human inspection and interpretation would be required for each document of study i.e. to determine likely section heading heights.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-pdftools">
<p>Ooms, Jeroen. 2020. <em>Pdftools: Text Extraction, Rendering and Converting of Pdf Documents</em>. <a href="https://CRAN.R-project.org/package=pdftools">https://CRAN.R-project.org/package=pdftools</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>The <code>pdftools</code> library requires the <code>poppler</code> development library. Installation instructions are described <a href="https://ropensci.org/blog/2016/03/01/pdftools-and-jeroen/">here</a>.<a href="ch-advanced-pdf-parsing.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="website-comparison-with-nlp.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
